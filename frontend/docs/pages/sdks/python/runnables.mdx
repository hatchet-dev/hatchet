# Runnables

## Workflow

**Bases:** `BaseWorkflow[TWorkflowInput]`

A Hatchet workflow allows you to define tasks and perform actions on the workflow.

Workflows in Hatchet represent coordinated units of work that can be triggered, scheduled, or run on a cron schedule. Each workflow can contain multiple tasks arranged in dependencies (DAGs), with customized retry behavior, timeouts, concurrency controls, and more.

### Example

```python
from pydantic import BaseModel
from hatchet_sdk import Hatchet

class MyInput(BaseModel):
    name: str

hatchet = Hatchet()
workflow = hatchet.workflow("my-workflow", input_type=MyInput)

@workflow.task()
def greet(input, ctx):
    return f"Hello, {input.name}!"

# Run the workflow
result = workflow.run(MyInput(name="World"))
```

Workflows support various execution patterns including:

- One-time execution with `run()` or `aio_run()`
- Scheduled execution with `schedule()`
- Cron-based recurring execution with `create_cron()`
- Bulk operations with `run_many()`

Tasks within workflows can be defined with `@workflow.task()` or `@workflow.durable_task()` decorators and can be arranged into complex dependency patterns.

---

### Methods

#### `task`

A decorator to transform a function into a Hatchet task that runs as part of a workflow.

**Parameters:**

| Name                  | Type                              | Description                                                                     | Default                     |
| --------------------- | --------------------------------- | ------------------------------------------------------------------------------- | --------------------------- |
| name                  | `str` or `None`                   | The name of the task. Defaults to the wrapped function's name if not specified. | `None`                      |
| schedule_timeout      | `Duration`                        | Maximum time to wait for the task to be scheduled.                              | `DEFAULT_SCHEDULE_TIMEOUT`  |
| execution_timeout     | `Duration`                        | Maximum time to wait for the task to complete.                                  | `DEFAULT_EXECUTION_TIMEOUT` |
| parents               | `list[Task[TWorkflowInput, Any]]` | List of parent tasks. Parents must be defined before their children.            | `[]`                        |
| retries               | `int`                             | Number of retries before failing.                                               | `0`                         |
| rate_limits           | `list[RateLimit]`                 | List of rate limit configurations.                                              | `[]`                        |
| desired_worker_labels | `dict[str, DesiredWorkerLabel]`   | Desired worker labels for task assignment.                                      | `{}`                        |
| backoff_factor        | `float` or `None`                 | Backoff factor for exponential backoff in retries.                              | `None`                      |
| backoff_max_seconds   | `int` or `None`                   | Maximum seconds for exponential backoff retries.                                | `None`                      |
| concurrency           | `list[ConcurrencyExpression]`     | List of concurrency expressions.                                                | `[]`                        |
| wait_for              | `list[Condition or OrGroup]`      | Conditions that must be met before the task runs.                               | `[]`                        |
| skip_if               | `list[Condition or OrGroup]`      | Conditions that, if met, cause the task to be skipped.                          | `[]`                        |
| cancel_if             | `list[Condition or OrGroup]`      | Conditions that, if met, cause the task to be canceled.                         | `[]`                        |

**Returns:**

`Callable[[Callable[[TWorkflowInput, Context], R]], Task[TWorkflowInput, R]]`: A decorator creating a Task object.

---

#### `durable_task`

A decorator to transform a function into a durable Hatchet task that runs as part of a workflow.

**IMPORTANT:** This decorator creates a _durable_ task, leveraging Hatchet's durable execution capabilities. This is an advanced feature. See the Hatchet docs for more information.

**Parameters:** (Same as `task` above)

**Returns:**

`Callable[[Callable[[TWorkflowInput, DurableContext], R]], Task[TWorkflowInput, R]]`: A decorator creating a durable Task object.

---

#### `on_failure_task`

A decorator to transform a function into a Hatchet on-failure task that runs as the last step in a workflow if at least one task fails.

**Parameters:**

| Name                | Type                          | Description                                                                            | Default                     |
| ------------------- | ----------------------------- | -------------------------------------------------------------------------------------- | --------------------------- |
| name                | `str` or `None`               | Name of the on-failure task. Defaults to the wrapped function's name if not specified. | `None`                      |
| schedule_timeout    | `Duration`                    | Maximum time to wait for the task to be scheduled.                                     | `DEFAULT_SCHEDULE_TIMEOUT`  |
| execution_timeout   | `Duration`                    | Maximum time to wait for the task to complete.                                         | `DEFAULT_EXECUTION_TIMEOUT` |
| retries             | `int`                         | Number of retries before failing.                                                      | `0`                         |
| rate_limits         | `list[RateLimit]`             | List of rate limit configurations.                                                     | `[]`                        |
| backoff_factor      | `float` or `None`             | Backoff factor for exponential backoff in retries.                                     | `None`                      |
| backoff_max_seconds | `int` or `None`               | Maximum seconds for exponential backoff retries.                                       | `None`                      |
| concurrency         | `list[ConcurrencyExpression]` | List of concurrency expressions.                                                       | `[]`                        |

**Returns:**

`Callable[[Callable[[TWorkflowInput, Context], R]], Task[TWorkflowInput, R]]`: A decorator creating an on-failure Task object.

---

#### `on_success_task`

A decorator to transform a function into a Hatchet on-success task that runs as the last step in a workflow if all upstream tasks succeed.

**Parameters:** (Same as `on_failure_task` above)

**Returns:**

`Callable[[Callable[[TWorkflowInput, Context], R]], Task[TWorkflowInput, R]]`: A decorator creating an on-success Task object.

---

#### `run`

Run the workflow synchronously and wait for it to complete.

This method triggers a workflow run, blocks until completion, and returns the final result.

**Parameters:**

| Name    | Type                     | Description                                                                     | Default                              |
| ------- | ------------------------ | ------------------------------------------------------------------------------- | ------------------------------------ |
| input   | `TWorkflowInput`         | Input data for the workflow, must match the workflow's input type.              | `cast(TWorkflowInput, EmptyModel())` |
| options | `TriggerWorkflowOptions` | Additional options for workflow execution like metadata and parent workflow ID. | `TriggerWorkflowOptions()`           |

**Returns:**

`dict[str, Any]`: The result of the workflow execution as a dictionary.

---

#### Other Methods

- `aio_run` _(async)_
- `run_no_wait`
- `aio_run_no_wait` _(async)_
- `run_many`
- `aio_run_many` _(async)_
- `schedule`
- `aio_schedule` _(async)_
- `create_cron`
- `aio_create_cron` _(async)_

---

#### `add_task`

Add a task to a workflow. Intended for use with a previously existing standalone task (created with `@hatchet.task()`), converted to a `Task` object using `to_task()`.

**Example:**

```python
@hatchet.task()
def my_task(input, ctx) -> None:
    pass

wf = hatchet.workflow()
wf.add_task(my_task.to_task())
```

---

## Task

**Bases:** `Generic[TWorkflowInput, R]`

A Task represents a single unit of work within a workflow. Tasks can be defined using decorators provided by Hatchet workflows (`@workflow.task()`, `@workflow.durable_task()`, etc.). Tasks can have dependencies, retries, timeouts, and other execution controls.
