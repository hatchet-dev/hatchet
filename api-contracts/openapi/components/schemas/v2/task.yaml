V2TaskSummary:
  properties:
    metadata:
      $ref: ".././metadata.yaml#/APIResourceMeta"
    taskId:
      type: integer
      description: The ID of the task.
    taskInsertedAt:
      type: string
      format: date-time
      description: The timestamp the task was inserted.
    status:
      $ref: "#/V2TaskStatus"
    startedAt:
      type: string
      format: date-time
      description: The timestamp the task run started.
    finishedAt:
      type: string
      format: date-time
      description: The timestamp the task run finished.
    duration:
      type: integer
      description: The duration of the task run, in milliseconds.
    tenantId:
      type: string
      description: The ID of the tenant.
      example: bb214807-246e-43a5-a25d-41761d1cff9e
      minLength: 36
      maxLength: 36
      format: uuid
    additionalMetadata:
      type: object
      description: Additional metadata for the task run.
    displayName:
      type: string
      description: The display name of the task run.
    workflowId:
      type: string
      format: uuid
    output:
      type: object
      description: The output of the task run (for the latest run)
    errorMessage:
      type: string
      description: The error message of the task run (for the latest run)
  required:
    - metadata
    - id
    - taskId
    - taskInsertedAt
    - status
    - tenantId
    - displayName
    - workflowId
    - output

V2DagChildren:
  type: object
  properties:
    dagId:
      type: string
      format: uuid
    children:
      type: array
      items:
        $ref: "#/V2TaskSummary"

V2TaskSummaryList:
  type: object
  properties:
    pagination:
      $ref: ".././metadata.yaml#/PaginationResponse"
    rows:
      type: array
      items:
        $ref: "#/V2TaskSummary"
      description: The list of tasks
  required:
    - pagination
    - rows

V2Task:
  properties:
    metadata:
      $ref: ".././metadata.yaml#/APIResourceMeta"
    taskId:
      type: integer
      description: The ID of the task.
    taskInsertedAt:
      type: string
      format: date-time
      description: The timestamp the task was inserted.
    status:
      $ref: "#/V2TaskStatus"
    startedAt:
      type: string
      format: date-time
      description: The timestamp the task run started.
    finishedAt:
      type: string
      format: date-time
      description: The timestamp the task run finished.
    duration:
      type: integer
      description: The duration of the task run, in milliseconds.
    tenantId:
      type: string
      description: The ID of the tenant.
      example: bb214807-246e-43a5-a25d-41761d1cff9e
      minLength: 36
      maxLength: 36
      format: uuid
    additionalMetadata:
      type: object
      description: Additional metadata for the task run.
    displayName:
      type: string
      description: The display name of the task run.
    workflowId:
      type: string
      format: uuid
    input:
      type: string
      description: The input for the task run.
    output:
      type: string
      description: The output of the task run (for the latest run)
    errorMessage:
      type: string
      description: The error message of the task run (for the latest run)
  required:
    - metadata
    - id
    - taskId
    - taskInsertedAt
    - status
    - tenantId
    - displayName
    - workflowId
    - input

V2TaskEventList:
  properties:
    pagination:
      $ref: ".././metadata.yaml#/PaginationResponse"
    rows:
      items:
        $ref: "#/V2WorkflowRunTaskEvent"
      type: array

V2WorkflowRunTaskEvent:
  type: object
  properties:
    tenantId:
      type: string
      format: uuid
      description: The ID of the tenant.
    taskId:
      type: integer
      format: int64
      description: The ID of the task.
    taskInsertedAt:
      type: string
      format: date-time
      description: The timestamp when the task was inserted.
    retryCount:
      type: integer
      format: int32
      description: Number of retry attempts.
    eventType:
      $ref: "#/V2TaskEventType"
      description: Type of the event.
    timeFirstSeen:
      type: string
      format: date-time
      description: Timestamp when the event was first seen.
      nullable: true
    timeLastSeen:
      type: string
      format: date-time
      description: Timestamp when the event was last seen.
      nullable: true
    count:
      type: integer
      format: int64
      description: Count of events.
    id:
      type: integer
      format: int64
      description: Unique identifier for the event.
    eventTimestamp:
      type: string
      format: date-time
      description: Timestamp when the event occurred.
    readableStatus:
      $ref: "#/V2TaskStatus"
      description: Human-readable status of the event.
    errorMessage:
      type: string
      description: Error message if any.
      nullable: true
    output:
      type: string
      format: byte
      description: Binary output data.
    workerId:
      type: string
      format: uuid
      description: ID of the worker processing the task.
    additionalEventData:
      type: string
      description: Additional data associated with the event.
      nullable: true
    additionalEventMessage:
      type: string
      description: Additional message associated with the event.
      nullable: true

V2TaskEvent:
  type: object
  properties:
    id:
      type: integer
    taskId:
      type: string
      format: uuid
    timestamp:
      type: string
      format: date-time
    eventType:
      $ref: "#/V2TaskEventType"
    message:
      type: string
    errorMessage:
      type: string
    output:
      type: string
    workerId:
      type: string
      format: uuid
  required:
    - id
    - taskId
    - timestamp
    - eventType
    - message

V2TaskStatus:
  type: string
  enum:
    - QUEUED
    - RUNNING
    - COMPLETED
    - CANCELLED
    - FAILED

V2TaskEventType:
  type: string
  enum:
    - REQUEUED_NO_WORKER
    - REQUEUED_RATE_LIMIT
    - SCHEDULING_TIMED_OUT
    - ASSIGNED
    - STARTED
    - FINISHED
    - FAILED
    - RETRYING
    - CANCELLED
    - TIMED_OUT
    - REASSIGNED
    - SLOT_RELEASED
    - TIMEOUT_REFRESHED
    - RETRIED_BY_USER
    - SENT_TO_WORKER
    - RATE_LIMIT_ERROR
    - ACKNOWLEDGED
    - CREATED
    - QUEUED
    - SKIPPED

V2TaskRunMetrics:
  type: array
  items:
    $ref: "#/V2TaskRunMetric"

V2TaskRunMetric:
  type: object
  properties:
    status:
      $ref: "#/V2TaskStatus"
    count:
      type: integer
  required:
    - status
    - count

V2TaskPointMetric:
  type: object
  properties:
    time:
      type: string
      format: date-time
    SUCCEEDED:
      type: integer
    FAILED:
      type: integer
  required:
    - time
    - SUCCEEDED
    - FAILED

V2TaskPointMetrics:
  type: object
  properties:
    results:
      type: array
      items:
        $ref: "#/V2TaskPointMetric"
