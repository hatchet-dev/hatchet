WorkflowRun:
  type: object
  properties:
    metadata:
      $ref: "./metadata.yaml#/APIResourceMeta"
    tenantId:
      type: string
    workflowVersionId:
      type: string
    workflowVersion:
      $ref: "./_index.yaml#/WorkflowVersion"
    status:
      $ref: "#/WorkflowRunStatus"
    displayName:
      type: string
    jobRuns:
      type: array
      items:
        $ref: "#/JobRun"
    triggeredBy:
      $ref: "#/WorkflowRunTriggeredBy"
    input:
      type: object
      additionalProperties: true
    error:
      type: string
    startedAt:
      type: string
      format: date-time
    finishedAt:
      type: string
      format: date-time
    parentId:
      type: string
      example: bb214807-246e-43a5-a25d-41761d1cff9e
      minLength: 36
      maxLength: 36
      format: uuid
    parentStepRunId:
      type: string
      example: bb214807-246e-43a5-a25d-41761d1cff9e
      minLength: 36
      maxLength: 36
      format: uuid
    additionalMetadata:
      type: object
      additionalProperties: true
  required:
    - metadata
    - tenantId
    - workflowVersionId
    - status
    - triggeredBy

WorkflowRunList:
  type: object
  properties:
    rows:
      type: array
      items:
        $ref: "#/WorkflowRun"
    pagination:
      $ref: "./metadata.yaml#/PaginationResponse"

WorkflowRunsMetricsCounts:
  type: object
  properties:
    PENDING:
      type: integer
    RUNNING:
      type: integer
    SUCCEEDED:
      type: integer
    FAILED:
      type: integer
    QUEUED:
      type: integer

WorkflowRunsMetrics:
  type: object
  properties:
    counts:
      type: object
      $ref: "#/WorkflowRunsMetricsCounts"

StepRunStatus:
  type: string
  enum:
    - PENDING
    - PENDING_ASSIGNMENT
    - ASSIGNED
    - RUNNING
    - SUCCEEDED
    - FAILED
    - CANCELLED

JobRunStatus:
  type: string
  enum:
    - PENDING
    - RUNNING
    - SUCCEEDED
    - FAILED
    - CANCELLED

WorkflowRunStatus:
  type: string
  enum:
    - PENDING
    - RUNNING
    - SUCCEEDED
    - FAILED
    - CANCELLED
    - QUEUED

WorkflowRunStatusList:
  type: array
  items:
    $ref: "#/WorkflowRunStatus"

WorkflowRunsCancelRequest:
  type: object
  properties:
    workflowRunIds:
      type: array
      items:
        type: string
        format: uuid
        minLength: 36
        maxLength: 36
  required:
    - workflowRunIds

WorkflowRunTriggeredBy:
  type: object
  properties:
    metadata:
      $ref: "./metadata.yaml#/APIResourceMeta"
    parentId:
      type: string
    eventId:
      type: string
    event:
      $ref: "./_index.yaml#/Event"
    cronParentId:
      type: string
    cronSchedule:
      type: string
  required:
    - metadata
    - parentId

JobRun:
  type: object
  properties:
    metadata:
      $ref: "./metadata.yaml#/APIResourceMeta"
    tenantId:
      type: string
    workflowRunId:
      type: string
    workflowRun:
      $ref: "#/WorkflowRun"
    jobId:
      type: string
    job:
      $ref: "./_index.yaml#/Job"
    tickerId:
      type: string
    stepRuns:
      type: array
      items:
        $ref: "#/StepRun"
    status:
      $ref: "#/JobRunStatus"
    result:
      type: object
    startedAt:
      type: string
      format: date-time
    finishedAt:
      type: string
      format: date-time
    timeoutAt:
      type: string
      format: date-time
    cancelledAt:
      type: string
      format: date-time
    cancelledReason:
      type: string
    cancelledError:
      type: string
  required:
    - metadata
    - tenantId
    - workflowRunId
    - jobId
    - status

StepRun:
  type: object
  properties:
    metadata:
      $ref: "./metadata.yaml#/APIResourceMeta"
    tenantId:
      type: string
    jobRunId:
      type: string
    jobRun:
      $ref: "#/JobRun"
    stepId:
      type: string
    step:
      $ref: "./_index.yaml#/Step"
    children:
      type: array
      items:
        type: string
    parents:
      type: array
      items:
        type: string
    childWorkflowRuns:
      type: array
      items:
        type: string
    workerId:
      type: string
    input:
      type: string
    output:
      type: string
    status:
      $ref: "#/StepRunStatus"
    requeueAfter:
      type: string
      format: date-time
    result:
      type: object
    error:
      type: string
    startedAt:
      type: string
      format: date-time
    startedAtEpoch:
      type: integer
    finishedAt:
      type: string
      format: date-time
    finishedAtEpoch:
      type: integer
    timeoutAt:
      type: string
      format: date-time
    timeoutAtEpoch:
      type: integer
    cancelledAt:
      type: string
      format: date-time
    cancelledAtEpoch:
      type: integer
    cancelledReason:
      type: string
    cancelledError:
      type: string
  required:
    - metadata
    - tenantId
    - jobRunId
    - stepId
    - status

StepRunEventReason:
  type: string
  enum:
    - REQUEUED_NO_WORKER
    - REQUEUED_RATE_LIMIT
    - SCHEDULING_TIMED_OUT
    - ASSIGNED
    - STARTED
    - FINISHED
    - FAILED
    - RETRYING
    - CANCELLED
    - TIMEOUT_REFRESHED
    - REASSIGNED
    - TIMED_OUT
    - SLOT_RELEASED
    - RETRIED_BY_USER

StepRunEventSeverity:
  type: string
  enum:
    - INFO
    - WARNING
    - CRITICAL

StepRunEvent:
  type: object
  properties:
    id:
      type: integer
    timeFirstSeen:
      type: string
      format: date-time
    timeLastSeen:
      type: string
      format: date-time
    stepRunId:
      type: string
    reason:
      $ref: "#/StepRunEventReason"
    severity:
      $ref: "#/StepRunEventSeverity"
    message:
      type: string
    count:
      type: integer
    data:
      type: object
  required:
    - id
    - timeFirstSeen
    - timeLastSeen
    - stepRunId
    - reason
    - severity
    - message
    - count

StepRunEventList:
  properties:
    pagination:
      $ref: "./metadata.yaml#/PaginationResponse"
    rows:
      items:
        $ref: "#/StepRunEvent"
      type: array

RerunStepRunRequest:
  properties:
    input:
      type: object
  required:
    - input

TriggerWorkflowRunRequest:
  properties:
    input:
      type: object
    additionalMetadata:
      type: object
  required:
    - input

CreatePullRequestFromStepRun:
  properties:
    branchName:
      type: string
  required:
    - branchName

PullRequestState:
  type: string
  enum:
    - open
    - closed

ListPullRequestsResponse:
  properties:
    pullRequests:
      type: array
      items:
        $ref: "#/PullRequest"
  required:
    - pullRequests

PullRequest:
  properties:
    repositoryOwner:
      type: string
    repositoryName:
      type: string
    pullRequestID:
      type: integer
    pullRequestTitle:
      type: string
    pullRequestNumber:
      type: integer
    pullRequestHeadBranch:
      type: string
    pullRequestBaseBranch:
      type: string
    pullRequestState:
      $ref: "#/PullRequestState"
  required:
    - repositoryOwner
    - repositoryName
    - pullRequestID
    - pullRequestTitle
    - pullRequestNumber
    - pullRequestHeadBranch
    - pullRequestBaseBranch
    - pullRequestState

GetStepRunDiffResponse:
  properties:
    diffs:
      type: array
      items:
        $ref: "#/StepRunDiff"
  required:
    - diffs

StepRunDiff:
  properties:
    key:
      type: string
    original:
      type: string
    modified:
      type: string
  required:
    - key
    - original
    - modified
