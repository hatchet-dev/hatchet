// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.24.0
// source: filters.sql

package sqlcv1

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
)

const createFilter = `-- name: CreateFilter :one
INSERT INTO v1_filter (
    tenant_id,
    workflow_id,
    workflow_version_id,
    resource_hint,
    expression,
    payload
) VALUES (
    $1::UUID,
    $2::UUID,
    $3::UUID,
    $4::TEXT,
    $5::TEXT,
    COALESCE($6::JSONB, '{}'::JSONB)
)
RETURNING id, tenant_id, workflow_id, workflow_version_id, resource_hint, expression, payload
`

type CreateFilterParams struct {
	Tenantid          pgtype.UUID `json:"tenantid"`
	Workflowid        pgtype.UUID `json:"workflowid"`
	Workflowversionid pgtype.UUID `json:"workflowversionid"`
	Resourcehint      string      `json:"resourcehint"`
	Expression        string      `json:"expression"`
	Payload           []byte      `json:"payload"`
}

func (q *Queries) CreateFilter(ctx context.Context, db DBTX, arg CreateFilterParams) (*V1Filter, error) {
	row := db.QueryRow(ctx, createFilter,
		arg.Tenantid,
		arg.Workflowid,
		arg.Workflowversionid,
		arg.Resourcehint,
		arg.Expression,
		arg.Payload,
	)
	var i V1Filter
	err := row.Scan(
		&i.ID,
		&i.TenantID,
		&i.WorkflowID,
		&i.WorkflowVersionID,
		&i.ResourceHint,
		&i.Expression,
		&i.Payload,
	)
	return &i, err
}

const listFilters = `-- name: ListFilters :many
SELECT id, tenant_id, workflow_id, workflow_version_id, resource_hint, expression, payload
FROM v1_filter
WHERE tenant_id = $1::UUID
  AND workflow_id = $2::UUID
  AND workflow_version_id = $3::UUID
  AND resource_hint = $4::TEXT
`

type ListFiltersParams struct {
	Tenantid          pgtype.UUID `json:"tenantid"`
	Workflowid        pgtype.UUID `json:"workflowid"`
	Workflowversionid pgtype.UUID `json:"workflowversionid"`
	Resourcehint      string      `json:"resourcehint"`
}

func (q *Queries) ListFilters(ctx context.Context, db DBTX, arg ListFiltersParams) ([]*V1Filter, error) {
	rows, err := db.Query(ctx, listFilters,
		arg.Tenantid,
		arg.Workflowid,
		arg.Workflowversionid,
		arg.Resourcehint,
	)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []*V1Filter
	for rows.Next() {
		var i V1Filter
		if err := rows.Scan(
			&i.ID,
			&i.TenantID,
			&i.WorkflowID,
			&i.WorkflowVersionID,
			&i.ResourceHint,
			&i.Expression,
			&i.Payload,
		); err != nil {
			return nil, err
		}
		items = append(items, &i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}
