// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.29.0
// source: durable_event_log.sql

package sqlcv1

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
)

const createDurableEventLog = `-- name: CreateDurableEventLog :one
INSERT INTO v1_durable_event_log (
    tenant_id,
    task_id,
    task_inserted_at,
    event_type,
    key,
    data
) VALUES (
    $1::uuid,
    $2::bigint,
    $3::timestamptz,
    $4::text,
    $5::text,
    $6::jsonb
)
ON CONFLICT (task_id, task_inserted_at, key) DO NOTHING
RETURNING id, tenant_id, task_id, task_inserted_at, event_type, key, data, created_at
`

type CreateDurableEventLogParams struct {
	TenantID       pgtype.UUID        `json:"tenant_id"`
	TaskID         int64              `json:"task_id"`
	TaskInsertedAt pgtype.Timestamptz `json:"task_inserted_at"`
	EventType      string             `json:"event_type"`
	Key            string             `json:"key"`
	Data           []byte             `json:"data"`
}

func (q *Queries) CreateDurableEventLog(ctx context.Context, db DBTX, arg CreateDurableEventLogParams) (*V1DurableEventLog, error) {
	row := db.QueryRow(ctx, createDurableEventLog,
		arg.TenantID,
		arg.TaskID,
		arg.TaskInsertedAt,
		arg.EventType,
		arg.Key,
		arg.Data,
	)
	var i V1DurableEventLog
	err := row.Scan(
		&i.ID,
		&i.TenantID,
		&i.TaskID,
		&i.TaskInsertedAt,
		&i.EventType,
		&i.Key,
		&i.Data,
		&i.CreatedAt,
	)
	return &i, err
}

const getDurableEventLog = `-- name: GetDurableEventLog :one
SELECT id, tenant_id, task_id, task_inserted_at, event_type, key, data, created_at
FROM v1_durable_event_log
WHERE
    tenant_id = $1::uuid
    AND task_id = $2::bigint
    AND task_inserted_at = $3::timestamptz
    AND key = $4::text
LIMIT 1
`

type GetDurableEventLogParams struct {
	TenantID       pgtype.UUID        `json:"tenant_id"`
	TaskID         int64              `json:"task_id"`
	TaskInsertedAt pgtype.Timestamptz `json:"task_inserted_at"`
	Key            string             `json:"key"`
}

func (q *Queries) GetDurableEventLog(ctx context.Context, db DBTX, arg GetDurableEventLogParams) (*V1DurableEventLog, error) {
	row := db.QueryRow(ctx, getDurableEventLog,
		arg.TenantID,
		arg.TaskID,
		arg.TaskInsertedAt,
		arg.Key,
	)
	var i V1DurableEventLog
	err := row.Scan(
		&i.ID,
		&i.TenantID,
		&i.TaskID,
		&i.TaskInsertedAt,
		&i.EventType,
		&i.Key,
		&i.Data,
		&i.CreatedAt,
	)
	return &i, err
}
